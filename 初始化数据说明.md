# 初始化测试数据说明

## 📝 自动初始化脚本

项目提供了自动化脚本来初始化飞书多维表格的测试数据。

### 使用方法

#### 1. 确保已安装依赖

```bash
npm install
```

#### 2. 运行初始化脚本

```bash
npm run init-data
```

### 脚本功能

脚本会自动向飞书多维表格添加以下测试数据:

#### 用户表 (4条数据)
| 用户名 | 密码 | 姓名 | 状态 |
|--------|------|------|------|
| test | 123456 | 测试用户 | 启用 |
| admin | admin123 | 管理员 | 启用 |
| user1 | 123456 | 张三 | 启用 |
| user2 | 123456 | 李四 | 启用 |

#### 商家公告表 (2条数据)
| 标题 | 内容 | 状态 |
|------|------|------|
| 欢迎光临 | 本店营业时间: 9:00-21:00，欢迎您的光临！ | 启用 |
| 优惠活动 | 本月特惠：全场8.8折，满100减20！ | 启用 |

#### 菜品分类表 (6条数据)
| 分类名称 | 排序 | 状态 |
|----------|------|------|
| 热菜 | 1 | 启用 |
| 凉菜 | 2 | 启用 |
| 主食 | 3 | 启用 |
| 汤品 | 4 | 启用 |
| 饮品 | 5 | 启用 |
| 甜品 | 6 | 启用 |

#### 菜品表 (16条数据)

**热菜类 (4道)**
- 宫保鸡丁 - ¥38
- 麻婆豆腐 - ¥28
- 鱼香肉丝 - ¥32
- 红烧肉 - ¥48

**凉菜类 (2道)**
- 凉拌黄瓜 - ¥15
- 拌三丝 - ¥18

**主食类 (3道)**
- 米饭 - ¥3
- 炒饭 - ¥18
- 面条 - ¥20

**汤品类 (2道)**
- 西红柿蛋汤 - ¥12
- 紫菜蛋花汤 - ¥10

**饮品类 (3道)**
- 可乐 - ¥8
- 雪碧 - ¥8
- 橙汁 - ¥12

**甜品类 (2道)**
- 红豆沙 - ¥15
- 冰淇淋 - ¥18

### ⚠️ 重要提示

#### 1. 菜品分类关联
由于飞书API的限制,脚本无法自动设置菜品的分类关联。**需要手动在飞书多维表格中为每个菜品关联对应的分类**:

1. 打开飞书多维表格
2. 进入菜品表
3. 点击每个菜品的 `category_id` 字段
4. 选择对应的分类:
   - 宫保鸡丁、麻婆豆腐、鱼香肉丝、红烧肉 → 热菜
   - 凉拌黄瓜、拌三丝 → 凉菜
   - 米饭、炒饭、面条 → 主食
   - 西红柿蛋汤、紫菜蛋花汤 → 汤品
   - 可乐、雪碧、橙汁 → 饮品
   - 红豆沙、冰淇淋 → 甜品

#### 2. 图片链接
- 菜品图片使用的是Unsplash的示例图片
- 如果需要替换为实际菜品图片,请在飞书表格中修改 `image_url` 字段

#### 3. 重复运行
- 脚本每次运行都会创建新的记录
- 如果需要重新初始化,请先在飞书表格中删除旧数据

### 脚本执行流程

```
1. 获取飞书访问令牌 (tenant_access_token)
   ↓
2. 添加用户数据 (4条)
   ↓
3. 添加商家公告数据 (2条)
   ↓
4. 添加菜品分类数据 (6条)
   ↓
5. 添加菜品数据 (16条)
   ↓
6. 完成 ✅
```

### 执行示例

```bash
$ npm run init-data

🚀 开始初始化测试数据...

配置信息:
- App Token: H6RubLi8aadl13sUFGscl8WKn2f
- 用户表ID: tblu886lTbkK6M9Y
- 商家公告表ID: tblXlmOtsddXhZkg
- 菜品分类表ID: tblsowH9WdUHkDwa
- 菜品表ID: tblu0rGzAh8vYd90

🔑 获取访问令牌...
✅ 访问令牌获取成功

📝 开始添加用户数据...
✅ 创建成功: { username: 'test', password: '123456', ... }
✅ 创建成功: { username: 'admin', password: 'admin123', ... }
...
✅ 用户数据添加完成

📢 开始添加商家公告数据...
...
✅ 商家公告数据添加完成

🗂️ 开始添加菜品分类数据...
...
✅ 菜品分类数据添加完成

🍜 开始添加菜品数据...
...
✅ 菜品数据添加完成

🎉 所有测试数据初始化完成!

📋 后续步骤:
1. 打开飞书多维表格
2. 在菜品表中为每个菜品关联对应的分类
3. 运行项目: npm run dev
4. 使用测试账号登录: test / 123456
```

## 🔧 手动初始化数据

如果自动脚本遇到问题,也可以手动在飞书多维表格中添加数据:

### 访问飞书多维表格
https://hx9pg0opel7.feishu.cn/wiki/Einjw3fPoiw0UKk4WVOcu6l6nLe

### 手动添加步骤

1. **用户表** - 至少添加一个测试用户
2. **商家公告表** - 添加1-2条公告
3. **菜品分类表** - 添加几个分类
4. **菜品表** - 添加菜品并关联分类
5. **订单表** - 无需初始化,下单后自动创建

## 📱 测试账号

初始化完成后,可以使用以下账号登录测试:

- **测试用户**: test / 123456
- **管理员**: admin / admin123
- **普通用户1**: user1 / 123456
- **普通用户2**: user2 / 123456

## ❓ 常见问题

### Q: 脚本执行失败
**可能原因**:
- 网络连接问题
- 飞书API权限不足
- App ID或Secret配置错误

**解决方案**:
- 检查网络连接
- 确认飞书应用权限配置
- 验证.env文件中的配置

### Q: 菜品没有显示
**可能原因**:
- 菜品分类没有关联
- 菜品状态不是"上架"

**解决方案**:
- 在飞书表格中手动关联分类
- 确保status字段值为"上架"

### Q: 登录失败
**可能原因**:
- 用户数据没有添加成功
- 用户状态不是"启用"

**解决方案**:
- 检查用户表数据
- 确保status字段值为"启用"

## 🎯 下一步

数据初始化完成后:

1. ✅ 为菜品关联分类
2. ✅ 启动项目: `npm run dev`
3. ✅ 访问: http://localhost:5173
4. ✅ 使用测试账号登录
5. ✅ 体验完整点餐流程

祝测试愉快! 🎉
