# 抽奖转盘数据表设计方案（基础版）

## 概述

为点餐小程序设计一个**简单的抽奖转盘演示功能**，需要两张核心数据表：
1. **奖品表** - 存储奖品基本信息和中奖概率
2. **抽奖记录表** - 记录用户抽奖历史

> 💡 **设计原则**：只保留最基本的功能，便于快速实现和演示

---

## 一、奖品表 (prize_table)

### 表名
`抽奖奖品表`

### 字段设计（共 8 个字段）

| 字段名 | 字段类型 | 是否必填 | 说明 | 示例值 |
|--------|---------|---------|------|--------|
| **prize_name** | 文本 | 是 | 奖品名称 | "5元优惠券" |
| **prize_icon** | 文本(URL) | 否 | 奖品图标URL | https://... |
| **win_probability** | 数字 | 是 | 中奖概率（%） | 10 |
| **sort_order** | 数字 | 是 | 显示顺序（转盘位置） | 1 |
| **status** | 单选 | 是 | 状态 | 启用/禁用 |
| **create_time** | 创建时间 | 是 | 创建时间（自动填充） | 2024-01-01 12:00 |


### 字段说明

#### 1. prize_name（奖品名称）
- 在转盘上显示的奖品名称
- 建议简短：3-6 个字
- 示例：`5元券`、`10元券`、`谢谢参与`

#### 2. prize_icon（奖品图标）
- 奖品图标的 URL 地址
- 可以使用 emoji 或图片链接
- 示例：`🎁`、`💰`、`🍔`、`😊`

#### 4. win_probability（中奖概率）
- 填写 0-100 之间的数字
- **所有启用奖品的概率之和 = 100**
- 示例：10 表示 10% 中奖概率

#### 5. sort_order（显示顺序）
- 决定奖品在转盘上的位置
- 从 1 开始，按顺序排列
- 建议：6-8 个奖品位置

#### 6. status（状态）
**选项值**：
- `启用` - 参与抽奖
- `禁用` - 不参与抽奖

---

## 二、抽奖记录表 (lottery_record_table)

### 表名
`抽奖记录表`

### 字段设计（共 5 个字段）

| 字段名 | 字段类型 | 是否必填 | 说明 | 示例值 |
|--------|---------|---------|------|--------|
| **username** | 文本 | 是 | 用户名 | test |
| **prize_name** | 文本 | 是 | 中奖奖品名称 | "5元优惠券" |
| **lottery_time** | 创建时间 | 是 | 抽奖时间（自动填充） | 2024-01-01 14:30 |
| **prize_icon** | 文本 | 否 | 奖品图标（冗余存储） | 🎁 |

### 字段说明

#### 1. username（用户名）
- 记录是哪个用户抽的奖
- 与用户表的 username 关联

#### 2. prize_name（奖品名称）
- 用户抽中的奖品名称
- **冗余存储**：即使奖品表修改，历史记录也不会变

#### 3. lottery_time（抽奖时间）
- 自动记录抽奖时间
- 字段类型选择"创建时间"，会自动填充

#### 4. prize_icon / prize_color（冗余字段）
- 冗余存储奖品的图标和颜色
- 用于在"我的奖品"页面展示
- 防止奖品表修改后，历史记录显示错误

---

## 三、示例数据

### 奖品表示例数据

| prize_name | prize_icon | prize_color | win_probability | sort_order | status |
|-----------|-----------|-------------|-----------------|-----------|--------|
| 5元券 | 🎁 | #FF6B6B | 10 | 1 | 启用 |
| 10元券 | 💰 | #4ECDC4 | 8 | 2 | 启用 |
| 免费米饭 | 🍚 | #95E1D3 | 12 | 3 | 启用 |
| 免费饮料 | 🥤 | #F38181 | 15 | 4 | 启用 |
| 再接再厉 | 💪 | #FECA57 | 25 | 5 | 启用 |
| 谢谢参与 | 😊 | #DFE4EA | 30 | 6 | 启用 |

**概率分配**：
- 5元券：10%
- 10元券：8%
- 免费米饭：12%
- 免费饮料：15%
- 再接再厉：25%
- 谢谢参与：30%
- **总计：100%** ✅

### 抽奖记录表示例数据

| username | prize_name | prize_icon | lottery_time |
|----------|-----------|-----------|-------------|
| test | 5元券 | 🎁 | 2024-01-01 14:30 |
| admin | 谢谢参与 | 😊 | 2024-01-01 15:00 |
| user1 | 免费米饭 | 🍚 | 2024-01-02 10:00 |

---

## 四、业务逻辑说明

### 抽奖流程（简化版）

```
用户点击"开始抽奖"
  ↓
获取所有启用的奖品
  ↓
根据概率随机选择一个奖品
  ↓
创建抽奖记录（记录用户名和奖品）
  ↓
返回中奖结果
  ↓
前端展示转盘动画和中奖弹窗
```

### 概率计算逻辑

**权重随机算法**：

```javascript
// 1. 获取所有启用的奖品
const prizes = [
  { name: '5元券', probability: 10 },
  { name: '10元券', probability: 8 },
  { name: '免费米饭', probability: 12 },
  { name: '免费饮料', probability: 15 },
  { name: '再接再厉', probability: 25 },
  { name: '谢谢参与', probability: 30 }
]

// 2. 生成 0-100 的随机数
const random = Math.random() * 100

// 3. 根据概率区间判断中奖
let cumulative = 0
for (const prize of prizes) {
  cumulative += prize.probability
  if (random < cumulative) {
    return prize  // 中奖
  }
}
```

**概率区间示例**：
```
[0-10)    → 5元券
[10-18)   → 10元券
[18-30)   → 免费米饭
[30-45)   → 免费饮料
[45-70)   → 再接再厉
[70-100)  → 谢谢参与
```

---

## 五、数据表关系

```
┌─────────────┐
│  用户表     │
└──────┬──────┘
       │
       │ username
       │
       ↓
┌─────────────┐
│ 抽奖记录表  │  ← 记录每次抽奖
└──────┬──────┘
       │
       │ prize_name（文本关联）
       │
       ↓
┌─────────────┐
│  奖品表     │  ← 配置奖品和概率
└─────────────┘
```

> 💡 **说明**：为了简化设计，抽奖记录表不使用"单向关联"字段，而是直接存储奖品名称（文本）

---

## 六、在飞书多维表格中创建

### 创建步骤

1. **登录飞书多维表格**
   - 访问：https://hx9pg0opel7.feishu.cn/base/WcmNbFvM5aRWdVsegQZcLa9gnme

2. **创建"抽奖奖品表"**
   - 点击左下角 `+` 添加数据表
   - 命名：`抽奖奖品表`
   - 添加 8 个字段（见上面的字段设计）

3. **创建"抽奖记录表"**
   - 再次点击 `+` 添加数据表
   - 命名：`抽奖记录表`
   - 添加 5 个字段（见上面的字段设计）

4. **添加测试数据**
   - 在奖品表中添加 6 个奖品（见示例数据）
   - 确保概率之和 = 100%

### 字段类型对照表

| 文档中的字段类型 | 飞书中选择的类型 |
|----------------|----------------|
| 文本 | 多行文本 |
| 文本(URL) | 多行文本 |
| 数字 | 数字 |
| 单选 | 单选 |
| 创建时间 | 创建时间 |
| 最后更新时间 | 最后更新时间 |

---

## 七、环境变量配置

创建完表后，在 `.env` 文件中添加：

```env
# 抽奖表配置
VITE_FEISHU_PRIZE_TABLE_ID=tblXXXXXXXXXXXX
VITE_FEISHU_LOTTERY_RECORD_TABLE_ID=tblYYYYYYYYYYYY
```

**获取表 ID 的方法**：
1. 在飞书多维表格中打开对应的表
2. 查看浏览器地址栏 URL
3. 找到 `?table=tblXXXXXXXXXXXX`
4. `tbl` 开头的就是表 ID

---

## 八、API 接口设计

### 需要实现的 3 个接口

```javascript
// 1. 获取奖品列表（用于显示转盘）
GET /api/lottery/prizes
// 返回：所有启用的奖品

// 2. 执行抽奖
POST /api/lottery/draw
// 参数：{ username: "test" }
// 返回：{ success: true, prize: {...} }

// 3. 获取用户抽奖记录（"我的奖品"页面）
GET /api/lottery/records?username=test
// 返回：用户的所有抽奖记录
```

---

## 九、前端页面建议

### 1. 转盘页面
- 圆形转盘，6-8 个扇形区域
- 显示奖品名称 + 图标 + 颜色
- 中间一个"开始抽奖"按钮
- 旋转动画（3-5秒）
- 中奖弹窗

### 2. 我的奖品页面
- 列表显示所有中奖记录
- 显示：奖品名称、图标、中奖时间
- 按时间倒序排列

---

## 总结

### ✅ 简化后的设计

- **奖品表**：8 个字段（去掉了库存、有效期、奖品类型等复杂字段）
- **抽奖记录表**：5 个字段（只记录最基本的信息）
- **总计**：13 个字段，快速实现演示功能

### 🎯 核心功能

1. ✅ 配置奖品和中奖概率
2. ✅ 概率抽奖算法
3. ✅ 记录用户抽奖历史
4. ✅ 展示转盘和中奖动画
5. ✅ "我的奖品"页面

### 📝 下一步

需要我帮你：
- ✅ 创建自动初始化数据的脚本？
- ✅ 实现抽奖 API 接口？
- ✅ 创建前端转盘组件？

随时告诉我需要实现哪一部分！
